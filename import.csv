import pandas
import dateutil
import datetime

#popit API
url="http://api.openhluttaw.org/en/persons/"

#store key in token.txt Don't commit this file
key = open('token.txt')
token = 'Token '+key.read().rstrip()

headers = {'Authorization': token }

# Example dictionary to post as JSON payload
# See http://www.popoloproject.com/specs/person.html

payload = {'birth_date': '1954-12-01', 'gender': 'male', 'image': 'https://storage.googleapis.com/staticassets/candidate-photos/Scan_D_20150826_0066.jpg', 'identifiers': [{'scheme': 'identifier__hluttaw', 'identifier': 'LWMP-02-0031'}], 'name': 'Nyan Tun'}
#r = requests.post(url, headers=headers, json=payload)
#r.content

#import persons

df = pandas.read_csv('mp-en.csv',header=1)

for mp in df.itertuples():

    identifier = mp[1]
    name = mp[4]
    group = mp[5]
    house = mp[6]
    constituency = mp[7]
    area = mp[8]
    start_date = mp[11]
    end_date = mp[12]
    gender = mp[15]
    birth_date = mp[17]
    phone = mp[26]
    email = mp[29]
    image = mp[33]

    if isinstance(mp[11], basestring):
        start_date = dateutil.parser.parse(mp[11]).strftime('%Y-%m-%d')
    else:
        start_date = None

    if isinstance(mp[12], basestring):
        end_date = dateutil.parser.parse(mp[12]).strftime('%Y-%m-%d')
    else:
        end_date = None

    if isinstance(mp[17], basestring):
        birth_date = dateutil.parser.parse(mp[17]).strftime('%Y-%m-%d')
    else:
        birth_date = None

    if isinstance(mp[33], basestring):
        image = mp[33]
    else:
        image = None

    payload = {
        'identifiers':[{ 'identifier':identifier,
                 'scheme':'identifier__hluttaw'}],
        'name':name,
        'gender':gender,
        'birth_date':birth_date,
        'image':image
    }

    #r = requests.post(url, headers=headers, json=payload)
    #r.content
